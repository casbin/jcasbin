name: Benchmark PR Check

on:
  pull_request:
    branches: [ master, 'benchmark/pr10' ] # Added benchmark/pr10 for testing purposes as per current context
    paths-ignore:
      - '**.md'

permissions:
  contents: read
  # PR æ¨¡å¼ä¸‹é€šå¸¸åªéœ€è¦è¯»æƒé™ï¼Œæˆ–è€…å†™è¯„è®ºæƒé™ï¼ˆå¦‚æœå¼€å¯ comment-on-alertï¼‰
  pull-requests: write

jobs:
  benchmark:
    name: JMH Benchmark (Smoke)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
          cache: 'maven'

      - name: Run JMH Benchmark (SMOKE Mode)
        env:
          BENCHMARK_MODE: SMOKE # âš¡ï¸ å¿«é€Ÿæ¨¡å¼ï¼šçº¦ 2-3 åˆ†é’Ÿï¼ŒéªŒè¯ä»£ç æ²¡å´©
        # ç¡®ä¿ä½ çš„ pom.xml å·²ç»åŒ…å«äº† JMH ä¾èµ–ï¼Œå¦åˆ™è¿™é‡Œä¼šæŠ¥é”™
        # Added -Djmh.output to match previous fix for avoiding checkout conflicts
        run: mvn test -Dtest=BenchmarkRunner -Djmh.output="target/jmh-result.json"

      - name: Report Benchmark Result
        uses: benchmark-action/github-action-benchmark@v1
        with:
          name: JCasbin Benchmark
          tool: 'jmh'
          output-file-path: target/jmh-result.json
          # ğŸš¨ å…³é”®é…ç½®ï¼šPR æ¨¡å¼ä¸‹ç»å¯¹ä¸è¦ Pushï¼
          auto-push: false
          save-data-file: false
          # å¯ä»¥åœ¨ PR ä¸‹æ–¹ç•™è¨€æŠ¥å‘Šæ€§èƒ½å˜åŒ–ï¼ˆå¯é€‰ï¼‰
          comment-on-alert: true
          fail-on-alert: false
          github-token: ${{ secrets.GITHUB_TOKEN }}
